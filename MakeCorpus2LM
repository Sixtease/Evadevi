EV_LM?=data/LM/bg.lat
EV_vocab_size?=1700

all: $(EV_LM) $(EV_wordlist_test_phonet)

$(EV_LM): data/LM/bg.arpa data/wordlist/WORDLIST-test
	mkdir -p `dirname "$(EV_LM)"`
	LANG=C H HBuild -s '<s>' '</s>' -n data/LM/bg.arpa data/wordlist/WORDLIST-test "$(EV_LM)"

data/wordlist/WORDLIST-test: $(EV_wordlist_test_phonet)
	mkdir -p data/wordlist
	echo '!!UNK' > data/wordlist/WORDLIST-test
	cut -d ' ' -f 1 < "$(EV_wordlist_test_phonet)" >> data/wordlist/WORDLIST-test

data/LM/bg.arpa: $(EV_corpus) data/wordlist/WORDLIST-test
	mkdir -p data/LM
	#mkdir -p temp/LM/counts
	#echo "$(EV_corpus)" > temp/LM/filelist
	#make-batch-counts temp/LM/filelist 10 cat temp/LM/counts
	#merge-batch-counts temp/LM/counts
	#make-big-lm -read temp/LM/counts/filelist-1.ngrams.gz -lm data/LM/bg.arpa -unk -map-unk '!!UNK' -order 2 -vocab data/wordlist/WORDLIST-test
	ngram-count -order 2 -vocab data/wordlist/WORDLIST-test -text "$(EV_corpus)" -lm data/LM/bg.arpa -unk -map-unk '!!UNK'

$(EV_wordlist_test_phonet): temp/unigram.csv
	head -n "$(EV_vocab_size)" < temp/unigram.csv | bin/vyslov.pl > "$(EV_wordlist_test_phonet)"

temp/unigram.csv: $(EV_corpus)
	mkdir -p temp
	bin/corpus2wordlist.pl < "$(EV_corpus)" > temp/unigram.csv
